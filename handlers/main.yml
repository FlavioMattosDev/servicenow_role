# handlers/main.yml
---
# Handlers para notificações e webhooks

- name: Send ServiceNow notification
  uri:
    url: "{{ notification_webhook_url | default(omit) }}"
    method: POST
    body_format: json
    body:
      event: "{{ notification_event }}"
      record_type: "{{ notification_record_type }}"
      record_id: "{{ notification_record_id }}"
      message: "{{ notification_message }}"
      status: "{{ notification_status }}"
    validate_certs: "{{ servicenow_default_validate_certs }}"
    timeout: "{{ servicenow_default_timeout }}"
  when: notification_webhook_url is defined
  run_once: true

- name: Log operation completion
  debug:
    msg: "ServiceNow operation {{ servicenow_operation }} completed for module {{ servicenow_module }}"
  when: servicenow_enable_debug | bool
  run_once: true
