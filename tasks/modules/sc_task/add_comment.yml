# tasks/modules/sc_task/add_comment.yml
---
# Adicionar comentário à Catalog Task

- name: "Validar parâmetros para adicionar comentário"
  assert:
    that:
      - sc_task_sys_id is defined
      - sc_task_comments is defined
    fail_msg: "sc_task_sys_id e sc_task_comments são obrigatórios"

- name: "Adicionar comentário à Catalog Task"
  servicenow.itsm.sc_task:
    instance: "{{ servicenow_connection.instance }}"
    username: "{{ servicenow_connection.username }}"
    password: "{{ servicenow_connection.password }}"
    timeout: "{{ servicenow_connection.timeout }}"
    validate_certs: "{{ servicenow_connection.validate_certs }}"

    state: present
    sys_id: "{{ sc_task_sys_id }}"

    # Adicionar comentário
    comments: "{{ sc_task_comments }}"

    # Adicionar nota de trabalho se especificado
    work_notes: "{{ sc_task_work_notes | default(omit) }}"

  register: sc_task_comment_result
  no_log: true

- name: "Exibir resultado"
  debug:
    msg: "Comentário adicionado ao Catalog Task {{ sc_task_sys_id }}"
  when: sc_task_comment_result is not failed
